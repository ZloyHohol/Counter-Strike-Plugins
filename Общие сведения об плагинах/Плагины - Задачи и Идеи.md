# Плагины - Задачи, Идеи и Известные Проблемы

Этот документ содержит список задач, идей для улучшения и известных проблем для различных плагинов, основанный на обратной связи.

---

## 1. PlayerRewardAndDiscipline (PRD)

*   **Статус:** Требует доработки.

*   **Проблема с MVP:** Секция MVP/СЦИ работает некорректно, особенно с ботами. Либо не начинается голосование, либо не начисляются деньги по его итогам. Требуется тестирование с реальными игроками для полной диагностики.

*   **Проблема с наказанием за тимкилл:** Система наказаний за убийство союзников не функционирует должным образом. Возможные причины: либо выбран режим по умолчанию, несовместимый с ботами (которые не могут голосовать), либо система не регистрирует тимкиллы от ботов.

---

## 2. HUD_Damage

*   **Статус:** <span style="color:green">**ИСПРАВЛЕНО**</span>.

*   **Реализовано:** В HUD-сообщение о нанесенном уроне добавлено отображение оставшейся брони у жертвы.
*   **Новый формат:** `Урон -%i | %sЖ | %sБ`.
*   **Дополнительно:** Удалена старая "одноцветная" версия плагина (`ShowDamage.sp`), все изменения внесены в `ShowDamage_MultiColour.sp`.

---

## 3. SmokeBombCombo (SBC_V3)

*   **Статус:** Требует доработки.

*   **Проблема с асинхронностью:** Эффекты плагина (урон и окрашивание дыма) прекращаются примерно за 1.5-2 секунды до того, как дым визуально полностью рассеется. Это создает рассинхронизацию между визуальным эффектом и его действием.

*   **Идея по улучшению:** Вынести в отдельный CVAR время действия эффектов плагина (токсичности и окрашивания). Это позволит администраторам гибко настраивать длительность эффектов, не прибегая к перекомпиляции плагина, особенно если в будущем появится возможность изменять стандартное время жизни дымовой гранаты.

---

## 4. SkinChooser v5.5

*   **Статус:** План для будущих версий.

*   **Интеграция с PRD (система "Клоун" за тимкилл):**
    *   **Задача:** Реализовать функционал, аналогичный старому плагину `tkclown.sp`. При наказании игрока за тимкилл через систему **PRD**, его модель должна принудительно меняться на "обидный" скин (например, скин клоуна).
    *   **Задача:** Во время действия этого наказания, игроку необходимо заблокировать доступ к меню `!models`. Он не должен иметь возможности сменить "наказанный" скин или сбросить его на стандартный.

*   **Возвращение вида от третьего лица:**
    *   **Задача:** Восстановить функционал просмотра своей модели от третьего лица, который был в старых версиях плагина (например, v5.3). Реализовать команды `!thirdon` / `!thirdoff`.
    *   **Ключевое требование:** Эта функция не должна требовать активации `sv_cheats 1` на сервере.

---

## 5. SoundManifest

*   **Статус:** <span style="color:green">**ИСПРАВЛЕНО**</span>.

*   **Проблема 1 (Решена):** Плагин переставал работать после первого раунда или даже после первого события серии убийств.
*   **Решение 1:** Логика обработки серий убийств была полностью переработана. Вместо ошибочной перезарядки по времени введена система "уровней", которая анонсирует только достижение нового, более высокого уровня серии (MultiKill, SuperKill и т.д.) один раз за раунд.

*   **Проблема 2 (Решена):** Плагин некорректно определял оружие, помечая большинство убийств как "SpecialKill".
*   **Решение 2:** Реализован полноценный классификатор оружия. Добавлены новые типы событий (`RifleKill`, `PistolKill`, `SniperKill` и т.д.), которые теперь корректно определяются. Старая ошибочная логика `SpecialKill` удалена.

---

## 6. Анализ логов от 2025-11-04 @ 18:35

На основе файлов `errors_20251104.log` и `L20251104.log` выявлены следующие технические проблемы:

*   **PlayerRewardAndDiscipline.smx:**
    *   **Ошибка:** `[SM] Exception reported: Invalid timer handle`
    *   **Описание:** Плагин генерирует множество ошибок, связанных с попыткой удалить недействительный или уже удаленный таймер. Это происходит в основном при спавне игроков (`Event_PlayerSpawn`), их отключении (`OnClientDisconnect`) и при смене карты (`OnMapStart`). Проблема указывает на фундаментальную ошибку в логике управления таймерами в плагине.

*   **SoundManifest-v3.smx:**
    *   **Ошибка:** `[SM] Exception reported: Language phrase "..." not found`
    *   **Описание:** Плагин не может найти в файле перевода ключевые фразы для игровых событий, такие как `FirstBlood_Message`, `SpecialKill_Message`, `Combo_Message`, `Suicide_Message`. Это приводит к ошибкам во время игры при наступлении этих событий.

*   **Файлы переводов (*.phrases.txt):**
    *   **Ошибка:** `[SM] Warning(s) encountered in translation file...`
    *   **Описание:** Файлы `PlayerRewardAndDiscipline.phrases.txt` и `SM_SoundManifest.phrases.txt` содержат многочисленные синтаксические ошибки (недопустимые символы, лишние пробелы, неверный формат). Из-за этих ошибок SourceMod не может корректно загрузить фразы, что является **основной причиной** ошибок в `SoundManifest-v3.smx` и, возможно, влияет на работу `PlayerRewardAndDiscipline.smx`.
    *   **Рекомендация:** Необходимо тщательно проверить и исправить оба файла переводов в соответствии с синтаксисом SourceMod.
