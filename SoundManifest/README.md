# SoundManifest

Плагин для динамического управления и загрузки звуковых файлов на клиенты.

## Принцип работы и ключевые наблюдения

Этот раздел документирует важные наблюдения о работе плагина и взаимодействии движка Source с пользовательским контентом, сделанные в ходе разработки и тестирования.

### Динамическая загрузка

Плагин `SoundManifest-v3.sp` реализует механизм динамического выбора файлов для загрузки клиенту. В коде отсутствуют жестко прописанные пути к файлам, что обеспечивает гибкость и простоту в управлении контентом.

### Обработка Custom-контента движком Source

Движок Counter-Strike: Source (appid 240) корректно обрабатывает пользовательский контент, расположенный как в виде отдельных папок (`cstrike/custom/my_custom_stuff/`), так и в виде `.vpk` архивов (`cstrike/custom/my_custom_stuff.vpk`).

Ключевым моментом является то, что движок "монтирует" эти файлы и папки, создавая для плагинов SourceMod единое "виртуальное" файловое пространство. Для плагина все файлы выглядят так, как будто они находятся в стандартных директориях (`cstrike/sound/`, `cstrike/materials/` и т.д.), независимо от их физического расположения в `custom`.

Это означает, что такие функции, как `FileExists(path, true)`, будут надежно работать и находить файлы, даже если они упакованы в VPK или находятся в кастомной папке.

### Механизм кеширования на стороне клиента

Было замечено, что после успешной загрузки файла клиентом, повторной загрузки в последующих игровых сессиях не происходит. Клиент сообщает серверу, что файл у него уже есть, и сервер пропускает его отправку, что оптимизирует процесс подключения к серверу.