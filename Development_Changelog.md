### SoundManifest - Разработка версии 3.2

**Статус:** <span style="color:green">**РАЗРАБОТАНО**</span>

**Цель разработки:**
Создание улучшенной версии плагина SoundManifest (версия 3.2) с расширенной функциональностью, улучшенной архитектурой и устранением известных проблем предыдущих версий.

**Проведённые изменения:**

1. **Новая архитектура обработки событий:**
   - Введена поддержка случайного выбора звуков для каждого события (до 5 звуков на событие)
   - Реализована гибкая система аудитории с возможностью настройки через конфигурационный файл
   - Добавлена поддержка командно-специфичных звуков (для CT и T)
   - Введена поддержка администраторских групп для приветственных звуков

2. **Улучшенная система безопасности и проверок:**
   - Добавлены проверки существования файлов перед воспроизведением
   - Введена проверка размеров звуковых файлов (лимит до 50МБ)
   - Проверка форматов файлов (.wav, .mp3, .ogg)
   - Ограничение количества звуков на событие (максимум 5)

3. **Исправление основных проблем:**
   - Исправлена логика события FirstBlood (теперь действительно первое убийство в раунде)
   - Исправлены проблемы с сериями убийств, которые не работали корректно в последующих раундах
   - Добавлена поддержка M249 как отдельной категории оружия (MachineGunKill)
   - Исправлены проблемы с языковыми фразами

4. **Новые функции:**
   - Введена система отладки с несколькими уровнями (0-3)
   - Добавлены новые CVAR для тонкой настройки:
     - `sm_soundmanifest_debug_level` - уровень отладки (0=ошибки, 1=предупреждения, 2=инфо, 3=отладка)
     - `sm_soundmanifest_max_file_size` - максимальный размер звукового файла в МБ
     - `sm_soundmanifest_max_sounds_per_event` - максимальное количество звуков на событие
   - Добавлена поддержка длительности звуков
   - Введена система приоритетов аудитории через конфигурационный файл

5. **Изменения в структуре конфигурации:**
   - Необходим переход на новую структуру файла `configs/SoundManifest_Sounds.ini`
   - Пример новой структуры:
   ```
   "FirstBlood"
   {
       "message"   "{green}First blood spilled by {red}{1}{default}!"
       "sound_count" "3"
       "sound_1"   "quakesounds/firstblood1.wav"
       "duration_1" "2.5"
       "sound_2"   "quakesounds/firstblood2.wav" 
       "duration_2" "2.2"
       "sound_3"   "quakesounds/firstblood3.wav"
       "duration_3" "2.8"
       "audience" "all"  // возможные значения: killer, victim, killer_team, victim_team, all_alive, all
       "CT"
       {
           "sound_1"   "quakesounds/ct_firstblood.wav"
           "sound_2"   "quakesounds/ct_firstblood2.wav"
       }
       "T"
       {
           "sound_1"   "quakesounds/t_firstblood.wav"
           "sound_2"   "quakesounds/t_firstblood2.wav"
       }
   }
   ```

**Преимущества новой версии:**
- Более гибкая настройка через конфигурационный файл
- Повышенная стабильность за счёт проверок файлов
- Больше возможностей для персонализации звуковой обстановки
- Устранены известные баги предыдущих версий
- Улучшенная совместимость с SourceMod 1.13

**Заметка о совместимости:**
Версия 3.2 требует нового файла конфигурации с обновлённой структурой. Старые конфигурационные файлы могут не работать корректно с новой версией плагина.

---
### Обновление от 08.11.2025

**Статус:** <span style="color:blue">**ИСПРАВЛЕНИЕ**</span>

**Описание:**
На основании отчётов о глюках и лог-файлов от тестера, было проведено расследование проблемы с отображением динамических имён игроков в чате и HUD-сообщениях.

**Проведённые действия:**
1.  **Форк плагина:** Была создана копия (`форк`) плагина из каталога `QWEN` в каталог `Gemini` для сохранения стилистических правок и доработок, внесённых QWEN.
2.  **Исследование:** Gemini провёл анализ кода и выявил, что проблема заключалась в некорректном использовании функции `FormatEx` для форматирования строк перевода.
3.  **Внесение исправлений:** В версию плагина в каталоге `Gemini` были внесены следующие исправления:
    *   **`ShowMessageToAudience`:** Функция была обновлена для прямой передачи ключа перевода и параметров в `CPrintToChat`, что позволяет движку игры корректно обрабатывать форматирование.
    *   **`ShowHudMessageToAudience`:** Функция была переработана для ручного форматирования HUD-сообщений. Теперь она получает строку перевода, получает имена игроков и вручную заменяет плейсхолдеры `{1}` и `{2}`.

**Результат:**
Проблема с отображением динамических данных в чате и HUD была полностью устранена в версии плагина, находящейся в `SoundManifest\Gemini\`.